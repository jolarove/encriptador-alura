<!DOCTYPE html>

<html lang="es">

    <head>

        <meta charset="UTF-8">
        <title>Encriptador de Texto</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/reset.css">

    </head>

    <body>
        <header>
            <img src="logo.png", class="logo">
        </header>

        
        <textarea class="cajaTex" id="tex" placeholder="ingrese el texto aqui"></textarea>

        <div id="botones">

            <button id="encriptar">Encriptar</button>
            <button id="desencriptar">Desencriptar</button>

        </div>

        <div class="cajaAlerta"> 

            <img src="exclamacion.png" id="alerta">
            <p class="condicionantes">Usa solo minúsculas y palabras sin acento</p>

        </div>
        
        <div class="cajaDerecha" id="divCon_Muñeco">

            <img src="Muñeco.png" class="muñeco">
            <p class="noMensaje">Ningún mensaje fue <br> encontrado</p>
            <p class="indicacionMensaje">Ingresa el texto que desee encriptar o <br> desencriptar</p>

        </div>

        <div class="cajaDerecha" id="divSin_Muñeco">

            <textarea id="desencriptado" disabled></textarea>
            <button id="copiar">Copiar</button>

        </div>

        <script>
            //Varibles
            var encriptar = document.getElementById("encriptar");
            var desencriptar = document.getElementById("desencriptar");
            var bloque = document.getElementById("divSin_Muñeco");
            var desencriptado = document.getElementById("desencriptado");
            var texto = document.getElementById("tex");
            var codigo =["ai","enter","imes","ober","ufat"];
            var vocales =["a","e","i","o","u"];
            var prohibidos = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z","á","é","í","ó","ú", "ñ","0",
        "1","2","3","4","5","6","7","8","9"];
            var encriptado;
            let placeholder = texto.placeholder;

            //Funciones

            function ocultarBloque () {

                bloque.style.display = "none";
                desencriptado.value = "";

            }

            function mostrarBloque () {
                bloque.style.display = "block";                           
               
            }
            
            //Aquí revisamos que se coloquen solo minúsculas y no acentos       
            function filtroCaracteres () {
                
                var letras = Array.from(texto.value);
                var seguir = true;
                var posicion = 0;
                
                console.log(letras)
                while (posicion < letras.length) {
                    var contador = 0;
                    var letra = letras[posicion];
                    
                    while (contador < prohibidos.length) {
                        console.log(prohibidos[contador], letras[posicion])
                    
                        if (letra != prohibidos[contador]) {
                            contador++;
                        }
                        else if (letra == prohibidos[contador]) {
                            ocultarBloque();
                            alert("Solo se permiten minúsculas y sin acentos. Ingrese nuevamente el texto");
                            texto.value= "ingrese el texto aqui";
                            seguir = false;
                            break;
                            
                        } 
                                       
                          
                    }
                    if (seguir == true) {
                        posicion++;
                    }
                    else {
                        break;
                        
                    }

                } 

                if (seguir == true) {
                    
                    mostrarBloque(); 
                    
                }
                else {
                    ocultarBloque();
                }
                            

            }

            //Implementamos la codificación solicitada para encriptar o desencriptar
            function codificacion(){
                var letras = Array.from(texto.value);
                var posicion = 0;
                var previo=[];
                var mensaje;
                var arr;
                var n;
                filtroCaracteres();
                
                while(posicion < letras.length){
                    
                    var contador = 0;
                    var letra = letras[posicion];
                    

                    while (contador < vocales.length) {

                        if (letra != vocales[contador]){
                            contador++;
                        }
                        else if(letra == vocales[contador]){
                            letra = codigo[contador];
                            
                        }
                       
                       
                    }

                    if (encriptado == true) {
                        previo.push(letra);
                        posicion++;
                    }
                    else {
                        arr = Array.from(letra);
                        letra = arr[0];  
                        previo.push(letra);
                        
                        posicion = posicion + arr.length;   
                    }
                    

                }
                mensaje = previo[0];
                var x = 1;
                while (x < previo.length){
                    mensaje = mensaje + previo[x];
                    x++;
                }
                console.log(mensaje);
                desencriptado.value = mensaje;
                
                
            }

            function encriptacion() {
                encriptado = true;
                codificacion();
            }

            //Implementamos la descodificación
            function descriptacion(){
                encriptado = false;
                codificacion();
            }

            //Aquí habilitamos el botón copiar
            function copiando(){

                if (document.selection) { 
                    var range = document.body.createTextRange();
                    range.moveToElementText(document.getElementById("desencriptado"));
                    range.select().createTextRange();
                    document.execCommand("Copy"); 

                } else if (document.getSelection) {
                    var range = document.createRange();
                    range.selectNode(document.getElementById("desencriptado"));
                    window.getSelection().addRange(range);
                    document.execCommand("Copy");
                    alert("Texto copiado con éxito") 
                }

                ocultarBloque();

            }

                    

            //Acciones
            encriptar.onclick = encriptacion;
            desencriptar.onclick = descriptacion;
            copiar.onclick = copiando;
            ocultarBloque();
            
           

        </script>

    </body>




</html>